$.Levels=[{pots:[!1,!0,!1],bottomLane:!1,speed:0.15,targetPots:1,monster:!1,bg:"res/bg1.png",ingredients:["potato"],hint:"Click potatos to cut them",loseable:!1},{pots:[!1,!0,!1],bottomLane:!1,speed:0.15,targetPots:1,monster:!1,bg:"res/bg1.png",ingredients:["potato","carot"],hint:"The order of vegetables\ndoes not matter",loseable:!1},{pots:[!1,!0,!1],bottomLane:!1,speed:0.15,targetPots:3,monster:!1,bg:"res/bg1.png",ingredients:["potato","carot"],hint:"Reach the specified number\nof pots to finish a level",loseable:!1},{pots:[!1,!0,!1],bottomLane:!1,speed:0.2,targetPots:3,monster:!1,bg:"res/bg1.png",ingredients:["potato","carot","onion"],hint:"Don't cut the wrong\nvegetables",loseable:!0},{pots:[!0,!1,!0],bottomLane:!0,speed:0.2,targetPots:5,monster:!1,bg:"res/bg2.png",ingredients:["potato","carot","onion"],hint:"Get a second chance for\neach vegetable",loseable:!0},{pots:[!0,!1,!0],bottomLane:!0,speed:0.2,targetPots:5,monster:!1,bg:"res/bg2.png",ingredients:["potato","carot","onion","brocoli"],hint:"Get some broccoli",loseable:!0},{pots:[!0,!1,!0],bottomLane:!0,speed:0.25,targetPots:10,monster:!1,bg:"res/bg2.png",ingredients:["potato","carot","onion","brocoli"],hint:"More soups,\nfaster vegetables",loseable:!0},{pots:[!0,!0,!0],bottomLane:!0,speed:0.25,targetPots:10,monster:!1,bg:"res/bg2.png",ingredients:["potato","carot","onion","brocoli"],hint:"More pots",loseable:!0},{pots:[!0,!0,!0],bottomLane:!0,speed:0.3,targetPots:10,monster:!1,bg:"res/bg2.png",ingredients:["potato","carot","onion","brocoli"],hint:"Even faster",loseable:!0},{pots:[!0,!0,!1],bottomLane:!0,speed:0.3,targetPots:10,monster:!0,monsterSpeed:0,monsterTimeToEat:5e3,monsterStunTime:3e3,bg:"res/bg2.png",ingredients:["potato","carot","onion","brocoli"],hint:"Beware the troll,\nit is hungry, too",loseable:!0},{pots:[!1,!0,!0],bottomLane:!0,speed:0.3,targetPots:10,monster:!0,monsterSpeed:0,monsterTimeToEat:4e3,monsterStunTime:1e3,bg:"res/bg2.png",ingredients:["potato","carot","onion","brocoli"],hint:"The troll wants more",loseable:!0},{pots:[!0,!0,!0],bottomLane:!0,speed:0.3,targetPots:10,monster:!0,monsterSpeed:-0.1,monsterTimeToEat:4e3,monsterStunTime:1e3,bg:"res/bg2.png",ingredients:["potato","carot","onion","brocoli"],hint:"IT MOVES!",loseable:!0},{pots:[!0,!0,!0],bottomLane:!0,speed:0.3,targetPots:10,monster:!0,monsterSpeed:-0.2,monsterTimeToEat:3e3,monsterStunTime:1e3,bg:"res/bg2.png",ingredients:["potato","carot","onion","brocoli"],hint:"Finale",loseable:!0}];function getRandom(a){return a[Math.floor(Math.random()*a.length)]}function collide(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.height+a.y>b.y}function shuffle(a){for(var d,e,b=a.length;0!==b;)e=Math.floor(Math.random()*b),b-=1,d=a[b],a[b]=a[e],a[e]=d;return a}$.Pot=function(a,b,d){this.ingredients=[],this.sprite=d,this.sprite.x=a,this.sprite.y=b,this.status=new PIXI.Container,this.reset()},$.Pot.prototype.initIngredients=function(){this.ingredients=[],this.status=new PIXI.Container;for(let b,a=0;3>a;++a){b=getRandom($.Levels[levelCounter].ingredients),console.log(b);let d=PIXI.loader.resources[$.INGREDIENT_IMAGES[b]].texture,e=new PIXI.Sprite(new PIXI.Texture(d,new PIXI.Rectangle(0,0,64,64)));e.x=this.sprite.x+15+30*a,e.y=this.sprite.y+this.sprite.height,e.scale.x*=0.4,e.scale.y*=0.4,this.ingredients.push({type:b,done:!1,sprite:e}),this.status.addChild(e)}},$.Pot.prototype.reset=function(){this.initIngredients(),this.updateStatus()},$.Pot.prototype.check=function(a){console.log("checking "+a.type);for(let b=0;b<this.ingredients.length;++b)if(!this.ingredients[b].done&&this.ingredients[b].type===a.type)return this.ingredients[b].done=!0,!0;return!1},$.Pot.prototype.updateStatus=function(){for(let b,a=0;a<this.ingredients.length;++a)b=this.ingredients[a],b.done&&this.status.removeChild(b.sprite)},$.Pot.prototype.isDone=function(){for(let a=0;a<this.ingredients.length;++a)if(!this.ingredients[a].done)return!1;return!0},$.Ingredient=function(a,b,d,e,g){this.type=d;let h=e.baseTexture,j=[new PIXI.Rectangle(0,0,64,64),new PIXI.Rectangle(64,0,64,64)];this.tex=j.map(function(k){return new PIXI.Texture(h,k)}),this.sprite=new PIXI.Sprite(this.tex[0]),this.sprite.x=a,this.sprite.y=b,this.vely=0,this.sprite.interactive=!0,this.sprite.buttonMode=!0,this.gone=!1,this.state="move_top",this.speed=g.speed,this.bottomLaneEnabled=g.bottomLane},$.Ingredient.prototype.move=function(a){"fall"===this.state?(this.vely+=0.06*a,this.sprite.y+=this.vely):this.bottomLaneEnabled&&"move_bottom"===this.state?this.sprite.x-=a*this.speed:this.sprite.x+=a*this.speed},$.Ingredient.prototype.makeFall=function(){this.state="fall",this.vely=-10,this.sprite.texture=this.tex[1]},$.Ingredient.prototype.moveToBottom=function(){"move_bottom"!==this.state&&(this.state="move_bottom",this.sprite.y+=105)},$.Monster=function(a,b,d,e,g){let h=PIXI.loader.resources["res/monster.png"].texture.baseTexture,j=[new PIXI.Rectangle(0,0,64,64),new PIXI.Rectangle(64,0,64,64),new PIXI.Rectangle(128,0,64,64)];this.tex=j.map(function(l){return new PIXI.Texture(h,l)}),this.sprite=new PIXI.Sprite(this.tex[0]),this.sprite.interactive=!0,this.sprite.buttonMode=!0,this.sprite.x=a,this.sprite.y=b;let k=this;this.velx=d,this.state="move",this.timeToEat=g,this.stateTimer=this.timeToEat,this.sprite.on("pointerdown",function(){("move"===k.state||"waitEat"===k.state)&&(punchSound.play(),k.state="stun",k.stateTimer=e)})},$.Monster.prototype.update=function(a){this.stateTimer-=a,"move"===this.state?(this.sprite.texture=this.tex[0],this.move(a),0>this.stateTimer&&(this.stateTimer=0,this.state="waitEat")):"stun"===this.state?(this.sprite.texture=this.tex[2],0>this.stateTimer&&(this.state="move",this.stateTimer=this.timeToEat)):"waitEat"===this.state?(this.sprite.texture=this.tex[0],this.move(a)):"eat"===this.state&&(this.sprite.texture=this.tex[1],0>this.stateTimer&&(this.state="move",this.stateTimer=this.timeToEat))},$.Monster.prototype.move=function(a){this.sprite.x+=this.velx*a,(0>this.sprite.x||this.sprite.x>576)&&(this.velx=-this.velx)},$.Monster.prototype.eat=function(a){console.log("eating "+a),this.state="eat",this.stateTimer=250},$.INGREDIENT_IMAGES={potato:"res/potato.png",onion:"res/onion.png",carot:"res/carot.png",brocoli:"res/brocoli.png"},$.INGREDIENT_TYPES=["potato","onion","carot","brocoli"];const worldWidth=640,worldHeight=360,MONSTER_TIME=3e3,CUT_TIME=300,INGREDIENT_SPAWN_TIME=1e3,INGREDIENTS=[{type:"potato",sprite:"res/potato.png"},{type:"onion",sprite:"res/onion.png"},{type:"carot",sprite:"res/carot.png"},{type:"brocoli",sprite:"res/brocoli.png"},{type:"potato",sprite:"res/potato.png"},{type:"onion",sprite:"res/onion.png"},{type:"carot",sprite:"res/carot.png"},{type:"brocoli",sprite:"res/brocoli.png"}];let bgMusic,cutSound,blubSound,potSound,punchSound,biteSound,music=!0,gameState="menu",levelCounter=-1,score=0,scoreText,potImage,pots=[],finishedPots=0,potContainer=new PIXI.Container,ingredients=[],ingredientContainer=new PIXI.Container,ingredientSpawnTime=INGREDIENT_SPAWN_TIME,cuts=[],scene,levelContainer,potText,monster,monsterCounter,ingredientQueue=[],app=new PIXI.Application({width:worldWidth,height:worldHeight,transparent:!0,antialias:!0});app.ticker.add(a=>gameLoop(a)),document.body.appendChild(app.view),PIXI.loader.add(["res/music.png","res/title.png","res/potato.png","res/onion.png","res/carot.png","res/brocoli.png","res/pot.png","res/cover.png","res/cut.png","res/levelclear.png","res/bg1.png","res/bg2.png","res/scoreboard.png","res/board.png","res/startbutton.png","res/gameover.png","res/win.png","res/monster.png"]).add("bgmusic","res/bg.ogg").add("cutSound","res/cut.ogg").add("blubSound","res/blub.ogg").add("potSound","res/pot.ogg").add("punchSound","res/punch.ogg").add("biteSound","res/bite.ogg").load(setup),PIXI.loader.load(function(a,b){bgMusic=b.bgmusic.sound,bgMusic.volume=0.05,bgMusic.loop=!0,cutSound=b.cutSound.sound,cutSound.volume=0.05,blubSound=b.blubSound.sound,blubSound.volume=0.05,potSound=b.potSound.sound,potSound.volume=0.1,punchSound=b.punchSound.sound,punchSound.volume=0.05,biteSound=b.biteSound.sound,biteSound.volume=0.3});function showLevelHint(){gameState="showHint";let a=new PIXI.Container,b=new PIXI.Sprite(PIXI.loader.resources["res/board.png"].texture);b.interactive=!0,b.buttonMode=!0,b.on("pointerdown",function(){scene.removeChild(a),gameState="game"}),a.addChild(b);let d=new PIXI.Text($.Levels[levelCounter].hint,{fontFamily:"OpenSans",fontSize:24,fill:16777215,align:"center"});d.x=200,d.y=160,a.addChild(b),a.addChild(d),scene.addChild(a)}function levelClear(){for(let b=0;b<cuts.length;++b)scene.removeChild(cuts[b].sprite);cuts=[],gameState="levelClear";let a=new PIXI.Sprite(PIXI.loader.resources["res/levelclear.png"].texture);a.interactive=!0,a.buttonMode=!0,a.on("pointerdown",function(){scene.removeChild(a),nextLevel()}),scene.addChild(a)}function gameOver(){gameState="gameOver",bgMusic.stop();let a=new PIXI.Sprite(PIXI.loader.resources["res/gameover.png"].texture);a.interactive=!0,a.buttonMode=!0,a.on("pointerdown",function(){scene.removeChild(a),setup()}),scene.addChild(a)}function createPotCounterSprite(){let a=new PIXI.Sprite(PIXI.loader.resources["res/pot.png"].texture);return a.x=570,a.y=320,a.scale.x*=0.3,a.scale.y*=0.3,a}function createMusicToggle(){let a=PIXI.loader.resources["res/music.png"].texture.baseTexture;var b=[new PIXI.Rectangle(0,0,64,64),new PIXI.Rectangle(64,0,64,64)],d=b.map(function(g){return new PIXI.Texture(a,g)});let e=new PIXI.Sprite(d[0]);return e.interactive=!0,e.buttonMode=!0,e.x=120,e.y=225,e.on("pointerdown",function(){music=!music,e.texture=music?d[0]:d[1]}),e}function startGame(){gameState="game",levelCounter=-1,score=0,scene.addChild(new PIXI.Sprite(PIXI.loader.resources["res/bg2.png"].texture));let a=new PIXI.Sprite(PIXI.loader.resources["res/scoreboard.png"].texture);a.x=10,a.y=300,scene.addChild(a),potText=new PIXI.Text("0",{fontFamily:"OpenSans",fontSize:18,fill:0,align:"center"}),potText.x=615,potText.y=325,scene.addChild(potText),nextLevel(),scoreText=new PIXI.Text(score,{fontFamily:"OpenSans",fontSize:18,fill:16777215,align:"center"}),scoreText.x=40,scoreText.y=335,scene.addChild(scoreText),scene.addChild(createPotCounterSprite()),music&&bgMusic.play()}function setup(){gameState="menu",app.stage.removeChild(scene),scene=new PIXI.Container;let a=createMusicToggle(),b=new PIXI.Sprite(PIXI.loader.resources["res/title.png"].texture),d=new PIXI.Sprite(PIXI.loader.resources["res/startbutton.png"].texture);d.interactive=!0,d.buttonMode=!0,d.x=110,d.y=160,d.on("pointerdown",function(){scene.removeChild(b),scene.removeChild(a),scene.removeChild(d),startGame()}),scene.addChild(b),scene.addChild(d),scene.addChild(a),app.stage.addChild(scene),app.renderer.interactive=!0,app.renderer.backgroundColor=16777215,app.renderer.view.style.position="absolute",app.renderer.view.style.display="block"}function setupPots(){pots=[],scene.removeChild(potContainer),potContainer=new PIXI.Container,$.Levels[levelCounter].pots[0]&&pots.push(new $.Pot(100,220,new PIXI.Sprite(PIXI.loader.resources["res/pot.png"].texture))),$.Levels[levelCounter].pots[1]&&pots.push(new $.Pot(260,220,new PIXI.Sprite(PIXI.loader.resources["res/pot.png"].texture))),$.Levels[levelCounter].pots[2]&&pots.push(new $.Pot(410,220,new PIXI.Sprite(PIXI.loader.resources["res/pot.png"].texture)));for(let a=0;a<pots.length;++a)potContainer.addChild(pots[a].sprite),potContainer.addChild(pots[a].status);scene.addChild(potContainer)}function setupIngredients(){ingredients=[],ingredientQueue=[],scene.removeChild(ingredientContainer),ingredientContainer=new PIXI.Container,scene.addChild(ingredientContainer),cuts=[]}function addMonster(){monster&&scene.removeChild(monster.sprite);let a=$.Levels[levelCounter];a.monster?(monster=new $.Monster(400,102,a.monsterSpeed,a.monsterStunTime,a.monsterTimeToEat),scene.addChild(monster.sprite)):monster=void 0}function nextLevel(){if(levelCounter+=1,levelCounter>=$.Levels.length){gameState="won",scene.addChild(new PIXI.Sprite(PIXI.loader.resources["res/win.png"].texture));let a=new PIXI.Text(score,{fontFamily:"OpenSans",fontSize:36,fill:16777215,align:"center"});a.x=300,a.y=200,scene.addChild(a)}else finishedPots=0,potText.text=$.Levels[levelCounter].targetPots,addMonster(),setupIngredients(),setupPots(),showLevelHint()}function buildRandomIngredient(){let a=$.Levels[levelCounter].ingredients;if(0==ingredientQueue.length){for(let e=0;e<a.length;++e)ingredientQueue.push(a[e]),ingredientQueue.push(a[e]),ingredientQueue.push(a[e]),ingredientQueue.push(a[e]),ingredientQueue.push(a[e]);ingredientQueue=shuffle(ingredientQueue)}let b=ingredientQueue.pop(),d=$.INGREDIENT_IMAGES[b];return new $.Ingredient(1,15,b,PIXI.loader.resources[d].texture,$.Levels[levelCounter])}function removeIngredientImage(a){a.gone=!0,ingredientContainer.removeChild(a.sprite)}function spawnIngredient(){let a=buildRandomIngredient();a.sprite.on("pointerdown",function(){a.makeFall();let b=new PIXI.Sprite(PIXI.loader.resources["res/cut.png"].texture);b.x=a.sprite.x,b.y=a.sprite.y,0.5<Math.random()&&(b.anchor.x=1,b.scale.x*=-1),scene.addChild(b),cuts.push({t:CUT_TIME,sprite:b,rem:!1}),cutSound.play()}),a.sprite.scale.x*=0.9,a.sprite.scale.y*=0.9,ingredientContainer.addChild(a.sprite),ingredients.push(a)}function updateIngredients(a){let b=!1;for(let e=0;e<ingredients.length;++e){if(ingredients[e].move(a),ingredients[e].sprite.x>worldWidth)$.Levels[levelCounter].bottomLane?ingredients[e].moveToBottom():(removeIngredientImage(ingredients[e]),b=!0);else if(0>ingredients[e].sprite.x)removeIngredientImage(ingredients[e]),b=!0;else if(ingredients[e].sprite.y>worldHeight)removeIngredientImage(ingredients[e]),b=!0,$.Levels[levelCounter].loseable&&--score;else{monster&&"waitEat"===monster.state&&!ingredients[e].gone&&"fall"!==ingredients[e].state&&collide(ingredients[e].sprite,monster.sprite)&&(monster.eat(ingredients[e].type),score-=1,removeIngredientImage(ingredients[e]),b=!0,biteSound.play());for(let g=0;g<pots.length;++g)!ingredients[e].gone&&collide(ingredients[e].sprite,pots[g].sprite)&&pots[g].check(ingredients[e])&&(score+=1,removeIngredientImage(ingredients[e]),b=!0,blubSound.play())}updateScoreDisplay()}if(b){var d=function(e){return!e.gone};ingredients=ingredients.filter(d)}ingredientSpawnTime-=a,0>=ingredientSpawnTime&&(ingredientSpawnTime=INGREDIENT_SPAWN_TIME,spawnIngredient())}function updateScoreDisplay(){let a=score;10>score&&(a=" "+a),100>score&&(a=" "+a),scoreText.text=a}function updatePots(){for(let b=0;b<pots.length;++b)if(pots[b].updateStatus(),pots[b].isDone()){let d=new PIXI.Sprite(PIXI.loader.resources["res/cover.png"].texture);if(d.x=pots[b].sprite.x,d.y=pots[b].sprite.y,potContainer.addChild(d),setTimeout(function(){potContainer.removeChild(d)},500),potContainer.removeChild(pots[b].status),++finishedPots,potSound.play(),potText.text=$.Levels[levelCounter].targetPots-finishedPots,pots[b].reset(),potContainer.addChild(pots[b].status),finishedPots>=$.Levels[levelCounter].targetPots){levelClear();break}}}function updateCuts(a){let b=!1;for(let e=0;e<cuts.length;++e)cuts[e].t-=a,0>=cuts[e].t&&(cuts[e].rem=!0,b=!0,scene.removeChild(cuts[e].sprite));if(b){var d=function(e){return!e.rem};cuts=cuts.filter(d)}}function gameLoop(){let b=app.ticker.elapsedMS;"game"==gameState&&(updateIngredients(b),updatePots(b),updateCuts(b),monster&&monster.update(b),0>score&&gameOver())}